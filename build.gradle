/*
 * This file was generated by the Gradle "init" task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */


apply plugin: "java"
apply plugin: "jacoco"

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
  mavenCentral()
}

configurations {
  jaxb
}

dependencies {
  jaxb "org.jvnet.jaxb2_commons:jaxb2-basics-ant:0.12.0"
  jaxb "org.jvnet.jaxb2_commons:jaxb2-basics:0.12.0"

  jaxb "javax.activation:activation:1.1.1"
  jaxb "javax.xml.bind:jaxb-api:2.3+"
  jaxb "org.glassfish.jaxb:jaxb-core:2.3+"
  jaxb "org.glassfish.jaxb:jaxb-runtime:2.3+"
  jaxb "org.glassfish.jaxb:jaxb-xjc:2.3+"

  jaxb "commons-beanutils:commons-beanutils:1.9.3"
  jaxb "commons-collections:commons-collections:3.2.2"
  jaxb "commons-io:commons-io:2.4"
  jaxb "org.apache.commons:commons-lang3:3.2.1"

  jaxb "org.slf4j:slf4j-api:1.7.7"
  jaxb "org.slf4j:slf4j-simple:1.7.7"
  jaxb "org.slf4j:jcl-over-slf4j:1.7.7"

  jaxb "com.google.code.javaparser:javaparser:1.0.11"


  testCompile "junit:junit-dep:4.11"
}

sourceSets {
  main {
    java {
      srcDirs = ["src"]
    }
    resources {
      srcDirs = ["etc"]
      includes = [
        "eqxml/*.xsd",
        "quakeml_1.2/*.xsd"
      ]
    }
  }

  test {
    java {
      srcDirs = ["src"]
    }
  }
}

test {
  filter {
    includeTestsMatching "*Test"
  }
}

jacocoTestReport {
  reports {
    html.enabled true
    xml.enabled true
  }
}
check.dependsOn jacocoTestReport


task jaxb() {
  ext.gensrc = "gensrc"
  mkdir(gensrc)

  doLast() {
    ant.taskdef(
        name: "xjc",
        classname: "org.jvnet.jaxb2_commons.xjc.XJC2Task",
        classpath: configurations.jaxb.asPath)

    ant.xjc(
        destdir: gensrc,
        extension: true,
        fork: true,
        package: "gov.usgs.ansseqmsg") {
      arg(line: "-enableIntrospection")
      binding(dir: "etc/eqxml", includes: "*.bindings.xml")
      schema(dir: "etc/eqxml", includes: "*.xsd")
      produces(dir: "${gensrc}/gov/usgs/ansseqmsg")
    }

    ant.xjc(
        destdir: gensrc,
        extension: true,
        fork: true,
        package: "org.quakeml_1_2") {
      arg(line: "-enableIntrospection")
      arg(line: "-Xwildcard")
      binding(dir: "etc/quakeml_1.2", includes: "*.bindings.xml")
      schema(dir: "etc/quakeml_1.2", includes: "*_jaxb.xsd")
      produces(dir: "${gensrc}/org/quakeml_1_2")
    }

  }
}
